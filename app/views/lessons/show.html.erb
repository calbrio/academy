<div class="lesson-header mb-4">
  <div class="d-flex justify-content-between align-items-start">
    <div>
      <h1><%= @lesson.title %></h1>
      <div class="text-muted">
        Lesson <%= @lesson.position %> in <%= link_to @course.title, course_path(@course) %>
      </div>
    </div>
    
    <% if user_signed_in? && current_user.enrolled_in?(@course) %>
      <% status = @lesson.completion_status_for(current_user) %>
      <div class="card border-<%= status == 'completed' ? 'success' : (status == 'in_progress' ? 'warning' : 'info') %> mb-3">
        <div class="card-body text-center">
          <h5 class="card-title">Your Progress</h5>
          <p class="card-text">
            <% case status %>
            <% when 'completed' %>
              <span class="badge bg-success">Completed</span>
            <% when 'in_progress' %>
              <span class="badge bg-warning">In Progress</span>
            <% else %>
              <span class="badge bg-info">Not Started</span>
              <% current_user.start_lesson!(@lesson) %>
            <% end %>
          </p>
          
          <% unless status == 'completed' %>
            <%= button_to lesson_lesson_completions_path(@lesson, status: 'completed'), 
                          method: :post, 
                          class: 'btn btn-success' do %>
              <i class="bi bi-check-circle"></i> Mark as Complete
            <% end %>
          <% end %>
        </div>
      </div>
    <% elsif !user_signed_in? %>
      <div class="alert alert-info">
        Sign in to track your progress on this lesson.
      </div>
    <% elsif !current_user.enrolled_in?(@course) %>
      <div class="alert alert-warning">
        You need to enroll in this course to track your progress.
        <%= button_to "Enroll Now", course_course_enrollments_path(@course), method: :post, class: "btn btn-success mt-2" %>
      </div>
    <% end %>
  </div>
</div>

<div class="lesson-description mb-4">
  <h3>Description</h3>
  <div class="card">
    <div class="card-body">
      <%= simple_format(@lesson.description) %>
    </div>
  </div>
</div>

<div class="lesson-navigation mb-4">
  <div class="d-flex justify-content-between">
    <% prev_lesson = @course.lessons.where("position < ?", @lesson.position).order(position: :desc).first %>
    <% next_lesson = @course.lessons.where("position > ?", @lesson.position).order(position: :asc).first %>
    
    <% if prev_lesson %>
      <%= link_to "← Previous: #{prev_lesson.title}", course_lesson_path(@course, prev_lesson), class: 'btn btn-outline-primary' %>
    <% else %>
      <span></span>
    <% end %>
    
    <% if next_lesson %>
      <%= link_to "Next: #{next_lesson.title} →", course_lesson_path(@course, next_lesson), class: 'btn btn-outline-primary' %>
    <% else %>
      <span></span>
    <% end %>
  </div>
</div>

<div class="lesson-actions">
  <%= link_to 'Edit Lesson', edit_course_lesson_path(@course, @lesson), class: 'btn btn-warning' %>
  <%= link_to 'Back to Course', course_path(@course), class: 'btn btn-secondary' %>
  <%= button_to 'Delete Lesson', course_lesson_path(@course, @lesson), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger' %>
</div>
